# Java Gradle CircleCI 2.0 configuration file
#
# Check https://circleci.com/docs/2.0/language-java/ for more details
#
version: 2
jobs:
    dependencies:
        pre:
        - mkdir -p "$ANDROID_HOME/licenses"
        - echo -e "\n8933bad161af4178b1185d1a37fbf41ea5269c55" > "$ANDROID_HOME/licenses/android-sdk-license"
        - echo -e "\n84831b9409646a918e30573bab4c9c91346d8abd" > "$ANDROID_HOME/licenses/android-sdk-preview-license"


        override:
        - echo y | android update sdk --no-ui --filter "android-28"
        - echo y | android update sdk --no-ui --filter "build-tools-28.0.3"
        - echo y | android update sdk --no-ui --filter "extra-android-m2repository"
        - echo y | android update sdk --no-ui --filter "extra-android-support"
        - echo y | android update sdk --no-ui --filter "extra-google-m2repositor"
        - ./gradlew dependencies || true

    build:
        docker:
        # specify the version you desire here
        - image: circleci/openjdk:8-jdk

        # Specify service dependencies here if necessary
        # CircleCI maintains a library of pre-built images
        # documented at https://circleci.com/docs/2.0/circleci-images/
        # - image: circleci/postgres:9.4

        working_directory: ~/repo

        environment:
            # Customize the JVM maximum heap limit
            JVM_OPTS: -Xmx3200m
            TERM: dumb
            ANDROID_HOME: /usr/local/android-sdk-linux

        steps:
        - checkout

        # Download and cache dependencies
        - restore_cache:
              keys:
              - v1-dependencies-{{ checksum "build.gradle" }}
              # fallback to using the latest cache if no exact match is found
              - v1-dependencies-

        - run: chmod +x gradlew


        - save_cache:
              paths:
              - ~/.gradle
              key: v1-dependencies-{{ checksum "build.gradle" }}

        # run tests!
        - run: ./gradlew build



